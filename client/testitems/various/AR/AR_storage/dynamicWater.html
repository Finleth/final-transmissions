<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
              content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Water</title>
        <link rel="stylesheet" type="text/css" href="ARstyle.css" />

        <script src="../../../assets/lib/aframe.js"></script>
        <script src="../../../assets/lib/aframe-ar.js"></script>

    </head>
    <body style='margin : 0; overflow: hidden;'>
        <!--<a-scene embedded artoolkit='sourceType: webcam;'>-->
            <!--<a-assets>-->
                <!--<video src="./Rain%20-%2078.mp4" id="water1" loop="true"></video>-->
                <!--<video src="./Rain%20-%2078.mp4" id="water2" loop="true"></video>-->
            <!--</a-assets>-->
            <!--<a-marker preset='hiro'>-->
                <!--<a-entity>-->
                    <!--<a-octahedron src='#water1' radius="1" material="opacity: 0.9" position="-2 0.5 0">-->
                        <!--<a-animation attribute="rotation"-->
                                     <!--dur="5000"-->
                                     <!--to="360 360 360"-->
                                     <!--easing= "linear"-->
                                     <!--repeat="indefinite">-->
                        <!--</a-animation>-->
                        <!--<a-animation attribute="position"-->
                                     <!--dur="3000"-->
                                     <!--from="-2 0.5 0"-->
                                     <!--to="-2 0.5 -3"-->
                                     <!--direction="alternate-reverse"-->
                                     <!--easing= "linear"-->
                                     <!--repeat="indefinite">-->
                        <!--</a-animation>-->
                    <!--</a-octahedron>-->
                <!--</a-entity>-->
                <!--<a-entity>-->
                    <!--<a-octahedron src='#water2' radius="1.5" material="opacity: 0.9" position="2 0.5 -3">-->
                        <!--<a-animation attribute="rotation"-->
                                     <!--dur="5000"-->
                                     <!--to="-360 -360 -360"-->
                                     <!--easing= "linear"-->
                                     <!--repeat="indefinite">-->
                        <!--</a-animation>-->
                        <!--<a-animation attribute="position"-->
                                     <!--dur="5000"-->
                                     <!--from="2 0.5 -3"-->
                                     <!--to="2 0.5 0"-->
                                     <!--direction="alternate-reverse"-->
                                     <!--easing= "linear"-->
                                     <!--repeat="indefinite">-->
                        <!--</a-animation>-->
                    <!--</a-octahedron>-->
                <!--</a-entity>-->
                <!--<a-entity light="type: ambient; color: #ccc; intensity: 3.0"></a-entity>-->
                <!--<a-entity light="type: spot; angle: 45; color: #3A43D4; intensity: 3.0" id="blue"></a-entity>-->
            <!--</a-marker>-->
        <!--</a-scene>-->
    </body>

<script>

    function setAttributes(el, attributeObj) {

        for (let item in attributeObj){
            el.setAttribute(item, attributeObj[item]);
        }

    }


    var waterSceneObj = {
        assets: [
            {
                src: "./AR_Assets/Rain%20-%2078.mp4",
                id: "water1",
                autoplay: "false",
                loop: "true"
            },
            {
                src: "./AR_Assets/Rain%20-%2078.mp4",
                id: "water2",
                autoplay: "false",
                loop: "true"
            }
        ],
        marker: {
            preset: "hiro"
        },
        entities: [

            {
                type: "shape",
                shape: "octahedron",
                dimensions: {
                    radius: "1"
                },
                material: {
                    opacity: "0.9"
                },
                otherAttr: {
                    src: "#water1",
                    position: "-2 0.5 0",
                    rotation: "0 0 0"
                },
                animations: [
                    {
                        attribute: "rotation",
                        dur: "5000",
                        to: "360 360 360",
                        easing: "linear",
                        repeat: "indefinite"
                    },
                    {
                        attribute: "position",
                        dur: "3000",
                        from: "-2 0.5 0",
                        to: "-2 0.5 -3",
                        direction: "alternate-reverse",
                        easing: "linear",
                        repeat: "indefinite"
                    }
                ]
            },
            {
                type: "shape",
                shape: "octahedron",
                dimensions: {
                    radius: "1.5"
                },
                material: {
                    opacity: "0.9"
                },
                otherAttr: {
                    src: "#water2",
                    position: "2 0.5 -3",
                    rotation: "0 0 0"
                },
                animations: [
                    {
                        attribute: "rotation",
                        dur: "5000",
                        to: "-360 -360 -360",
                        easing: "linear",
                        repeat: "indefinite"
                    },
                    {
                        attribute: "position",
                        dur: "3000",
                        from: "2 0.5 -3",
                        to: "2 0.5 0",
                        direction: "alternate-reverse",
                        easing: "linear",
                        repeat: "indefinite"
                    }
                ]
            }
        ]
    };


    window.addEventListener("load", function(){
        createScene(waterSceneObj);
    });








    function createScene(object){

        var body = document.getElementsByTagName('BODY')[0];

        var scene = document.createElement('a-scene');
        scene.setAttribute('embedded');
        scene.setAttribute('artoolkit', 'sourceType: webcam;');

        var assets = document.createElement('a-assets');


        body.appendChild(scene);
        scene.appendChild(assets);


        for (var assets_i=0; assets_i<object.assets.length; assets_i++){
            var assetItem = document.createElement('video');
            setAttributes(assetItem, object.assets[assets_i]);
            assets.appendChild(assetItem);
        }

        var marker = document.createElement('a-marker');
        marker.setAttribute("preset", object.marker.preset);
        scene.appendChild(marker);

        for (var entity_i=0; entity_i<object.entities.length; entity_i++) {

            var entity = document.createElement('a-entity');
            var shape = document.createElement(`a-${object.entities[entity_i].shape}`);

            setAttributes(shape, object.entities[entity_i].dimensions);
            shape.setAttribute("opacity", object.entities[entity_i].material.opacity);
            setAttributes(shape, object.entities[entity_i].otherAttr);

            for (var animation_i = 0; animation_i < object.entities[entity_i].animations.length; animation_i++) {
                var animation = document.createElement('a-animation');
                setAttributes(animation, object.entities[entity_i].animations[animation_i]);
                shape.appendChild(animation);
            }

            entity.appendChild(shape);
            marker.appendChild(entity);
        }
    }


    window.addEventListener("load", function(){
        createScene(waterSceneObj);

        const water1 = document.getElementById("water1");
        const water2 = document.getElementById("water2");

        water1.currentTime = 1000;
        water1.play();
        water2.currentTime = 6000;
        water2.playbackRate = 1.3;
        water2.play();
    });




</script>

</html>


